----------------------------------------------------------------------------------------------------------------------
--	Выдача информации сталкерам.
--	автор: Диденко Руслан (Stohe)
--	TODO: 
----------------------------------------------------------------------------------------------------------------------

local info_by_community = {
		stalker = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15"},

		monolith = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"},

		military = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_10"},

		killer = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_7",
					"stalker_story_10",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15"},

		ecolog = {		encyclopedy_zone_surge},

		dolg = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_12",
					"stalker_story_13"},

		freedom = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15"},

		bandit = {		"encyclopedy_zone_zone-story_story-2006",
					"encyclopedy_zone_zone-story_story-2008",
					"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12"}

		}

local info_by_rank = {
		novice = {		"encyclopedy_zone_zone-story_story-2006"},

		experienced = {		"encyclopedy_zone_zone-story_story-2008",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					},

		veteran = {		"encyclopedy_zone_zone-story_story-2010",
					"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					},

		master = {		"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					},

		legend = {		"encyclopedy_zone_zone-story_story-raid",
					"stalker_story_1",
					"stalker_story_2",
					"stalker_story_3",
					"stalker_story_4",
					"stalker_story_5",
					"stalker_story_6",
					"stalker_story_7",
					"stalker_story_8",
					"stalker_story_9",
					"stalker_story_10",
					"stalker_story_11",
					"stalker_story_12",
					"stalker_story_13",
					"stalker_story_14",
					"stalker_story_15",
					"stalker_story_16",
					"stalker_story_17",
					"stalker_story_18",
					"stalker_story_19",
					"stalker_story_20"
					}
		}


function loadInfo(npc, char_ini)
	-- Загрузка из кастом даты
	if char_ini:section_exist("known_info") then
		local n = char_ini:line_count("known_info")
		local result, id, value = 0,"",""
	
		for i=0,n-1 do
			result, id, value = char_ini:r_line("known_info",i,"","")

			give_npc_info(npc, id)
		end
	end
	
	
	-- Загрузка из генератора.
	local community_info = info_by_community[npc:character_community()]
	if community_info == nil then
		return
	end
	
	local rank = ranks.get_obj_rank_name(npc)
	local rank_info = info_by_rank[rank]
	if rank_info == nil then
		return
	end

	local tt = {}
	-- оставляем инфопоршны, которые есть и там и там.
	for k,v in pairs(community_info) do
		for kk,vv in pairs(rank_info) do
			if v == vv then
				-- Добавляем в список доступных знаний
				table.insert(tt, v)
				break
			end
		end	
	end
	
	local size = table.getn(tt)
	for k = 1,math.min(size,3) do	
		if math.random(100) >= 60 then
			local ii = tt[math.random(size)]
			give_npc_info(npc, ii)
		end
	end
end

function give_npc_info(npc, info)
	-- Даем НПС инфопоршны
	npc:give_info_portion(info)

	-- Проверяем есть ли озвученная история на этот инфопоршн, и если есть
	-- добавляем ее тоже
	if sound_theme.theme[info] ~= nil then
		if db.story_by_id[npc:id()] == nil then
			db.story_by_id[npc:id()] = {}
		end
		
		table.insert(db.story_by_id[npc:id()], info)
	end
end

function give_locations_info()
 if not has_alife_info("encyclopedy_zone_locations_predbannik") then
  db.actor:give_info_portion("encyclopedy_zone_locations_predbannik")
  db.actor:give_info_portion("encyclopedy_zone_locations_marsh")
  db.actor:give_info_portion("encyclopedy_zone_locations_swamp_old")
  db.actor:give_info_portion("encyclopedy_zone_locations_lost_village")
  db.actor:give_info_portion("encyclopedy_zone_locations_garbage_old")
  db.actor:give_info_portion("encyclopedy_zone_locations_red_forest")
  db.actor:give_info_portion("encyclopedy_zone_locations_zaton")
  db.actor:give_info_portion("encyclopedy_zone_locations_jupiter")
  db.actor:give_info_portion("encyclopedy_zone_locations_puzir")
  db.actor:give_info_portion("encyclopedy_zone_locations_aver")
  db.actor:give_info_portion("encyclopedy_zone_locations_atp_for_test22")
  db.actor:give_info_portion("encyclopedy_zone_locations_yantar_old")
  db.actor:give_info_portion("encyclopedy_zone_locations_limansk")
  db.actor:give_info_portion("encyclopedy_zone_locations_dead_city")
  db.actor:give_info_portion("encyclopedy_zone_locations_hospital")
  db.actor:give_info_portion("encyclopedy_zone_locations_pripyat")
  db.actor:give_info_portion("encyclopedy_zone_locations_generators")
  db.actor:give_info_portion("encyclopedy_zone_locations_escape")
  db.actor:give_info_portion("encyclopedy_zone_locations_garbage")
  db.actor:give_info_portion("encyclopedy_zone_locations_agroprom")
  db.actor:give_info_portion("encyclopedy_zone_locations_darkdolina")
  db.actor:give_info_portion("encyclopedy_zone_locations_bar")
  db.actor:give_info_portion("encyclopedy_zone_locations_rostok")
  db.actor:give_info_portion("encyclopedy_zone_locations_yantar")
  db.actor:give_info_portion("encyclopedy_zone_locations_military-loc")
  db.actor:give_info_portion("encyclopedy_zone_locations_radar")
  db.actor:give_info_portion("encyclopedy_zone_locations_pripiat")
  db.actor:give_info_portion("encyclopedy_zone_locations_stancia")

  db.actor:give_info_portion("encyclopedy_zone_artifact_af-medusa")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-cristall-flower")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-night-star")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-vyvert")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-gravi")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-gold-fish")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-blood")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-mincer-meat")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-soul")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-drops")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-fireball")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-cristall")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-electra-sparkler")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-electra-flash")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-electra-moonlight")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-rusty-thorn")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-rusty-kristall")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-rusty-sea-urchin")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-fuzz-kolobok")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-ameba-slime")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-ameba-slug")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-ameba-mica")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-dummy-glassbeads")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-dummy-pellicle")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-dummy-battery")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-dummy-dummy")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-dummy-spring")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-baloon")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-eye")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-fire")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-glass")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-ice")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-compass")
  db.actor:give_info_portion("encyclopedy_zone_artifact_af-cristall-plant")

  db.actor:give_info_portion("encyclopedy_zone_anomalies_bald")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_gravi")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_meat")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_zharka")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_electra")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_fuzz")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_radioactive")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_ameba")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_sphere")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_smallrain")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_xvatalka")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_monolit")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_emi")
  db.actor:give_info_portion("encyclopedy_zone_anomalies_smallrain1")

  db.actor:give_info_portion("encyclopedy_mutant_crow_general")
  db.actor:give_info_portion("encyclopedy_mutant_flesh_general")
  db.actor:give_info_portion("encyclopedy_mutant_blind_general")
  db.actor:give_info_portion("encyclopedy_mutant_tushkano")
  db.actor:give_info_portion("encyclopedy_mutant_boar_general")
  db.actor:give_info_portion("encyclopedy_mutant_pseudodog_general")
  db.actor:give_info_portion("encyclopedy_mutant_bloodsucker_general")
  db.actor:give_info_portion("encyclopedy_mutant_fracture_general")
  db.actor:give_info_portion("encyclopedy_mutant_chimera_general")
  db.actor:give_info_portion("encyclopedy_mutant_burer_general")
  db.actor:give_info_portion("encyclopedy_mutant_zombie_general")
  db.actor:give_info_portion("encyclopedy_mutant_zombieg_general")
  db.actor:give_info_portion("encyclopedy_mutant_nozombie_general")
  db.actor:give_info_portion("encyclopedy_mutant_spider_general")
  db.actor:give_info_portion("encyclopedy_mutant_cat_general")
  db.actor:give_info_portion("encyclopedy_mutant_pseudogiant_general")
  db.actor:give_info_portion("encyclopedy_mutant_poltergeist_general")
  db.actor:give_info_portion("encyclopedy_mutant_controller_general")
  db.actor:give_info_portion("encyclopedy_mutant_snork_general")

  db.actor:give_info_portion("encyclopedy_social_military_army")
  db.actor:give_info_portion("encyclopedy_social_military_milstalkers")
  db.actor:give_info_portion("encyclopedy_social_scientists_mobile-labs")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_duty")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_freedom")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_monolith")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_zomstalkers")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_bandits")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_killers")
  db.actor:give_info_portion("encyclopedy_social_stalker-clans_loners")
 end
end